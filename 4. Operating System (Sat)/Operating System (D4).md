# 4주차 1교시: 프로세스 연산
## M13. 프로세스의 생성과 복사
### (1) 프로세스의 구조
코드 영역
- 프로그램의 본문이 기술된 곳
- 프로그래머가 작성한 코드가 탑재되며 탑재된 코드는 읽기 전용으로 처리됨.

데이터 영역
- 코드가 실행되면서 사용하는 변수나 파일 등의 각종 데이터를 모아놓은 곳
- 데이터는 변하는 값이기 때문에 이곳의 내용은 기본적으로 읽기와 쓰기가 가능

스택 영역
- 운영체제가 프로세스를 실행하기 위해 부수적으로 필요한 데이터를 모아놓은 곳
- 프로세스 내에서 함수를 호출하면 함수를 수행하고 원래 프로그램을 되돌아올 위치를 이 영역에 저장
- 운영체제가 사용자의 프로세스를 작동하기 위해 유지하는 영역이므로 사용자에게는 보이지 않음

### (2) 프로세스의 생성과 복사
fork() 시스템 호출의 개념
- 실행 중인 프로세스로부터 새로운 프로세스를 복사하는 함수
- 실행 중인 프로세스와 똑같은 프로세스가 하나 더 만들어짐

새로운 프로세스를 띄우는 시스템 콜
- `pid`라는 변수를 선언하면서 동시에 fork 함수를 실행하고 반환값을 pid에 저장하게 하여, 함수 fork()가 실행되는 순간, 프로세스 하나가 복제됨.
- `pid 0`이 부모 프로세스

## N14. 프로세스의 전환 과정
### (1) 프로세스의 전환
exec() 시스템 호출의 개념
- 기존의 프로세스를 새로운 프로세스로 전환(재사용)하는 함수
  - fork(): 새로운 프로세스를 복사하는 시스템 호출
  - exec(): 프로세스를 그대로 둔 채, 내용만 바꾸는 시스템 호출

### (2) 프로세스의 계층 구조
- 유닉스 프로세스 계층 구조
  - 유닉스의 모든 프로세스는 init 프로세스의 자식이 되어 트리 구조를 이룸

> /
> - bin
> - etc
>   - hosts
> - usr
>   - bin
>   - lib
> - home
>   - user1
> - tmp

프로세스 계층 구조의 장점
- 여러 작업을 동시에 처리할 수 있음.
- 하나의 시스템에 여러 사용자가 사용 가능함.
- 자원 회수가 쉬움
- 프로세스 간의 책임 관계가 명확해짐.

---
# 4주차 2교시: 
## O15. 스레드의 개념
**스레드란?**  
정의: CPU 스케줄러가 CPU에 전달하는 일

- CPU가 처리하는 **작업의 단위**는 프로세스로부터 전달받은 **스레드**

### (1) 스레드의 구조
- 경량 프로세스 (LWP)
  - 중량 프로세스 (HWP)
- 프로세서를 사용하는 기본 단위
- 명령어를 독립적으로 실행할 수 있는 하나의 제어 흐름

**작업**
- 스레드의 그룹 환경으로, 같은 그룹의 스레드와 코드, 주소 공간, 운영체제의 자원(파일, 신호) 등을 공유함
- 작업에 스레드가 없으면 아무 일도 실행 안됨.

**각 스레드는 다음의 내용을 포함**
- 스레드 실행 시의 상태(실행, 준비 등)
- 실행 스택
- 지역 변수와 스레드의 특정 데이터를 저장하기 위한 스레드별 정적 저장소
- 프로세스의 다른 스레드가 공유하는 프로세스의 메모리와 자원에 대한 접근 등의 스레드 실행 환경 정보(문맥 정보)

**텍스트** &rarr; **전역 데이터** &rarr; **실행 힙**

### (2) 스레드의 장점
- 사용자에 대한 응답성 증가
  - 응용 프로그램 하나가 비슷한 작업들을 여러개 수행
  - 응용 프로그램의 일부분이 봉쇄 또는 긴 작업 수행시에도 프로그램 실행을 계속 허용하여 사용자에 대한 응답성 증가
- 경제성
  - 한 프로세스의 자원을 공유하므로 프로세스를 생성하는 것보다 오버헤드를 줄일 수 있음.
- 프로세스의 자원과 메모리 공유 가능
  - 프로세스에 포함된 스레드들은 공통의 목적 달성을 위해 병렬로 실행
  - 자원을 공유하여 한 프로세스에서 동시 작업 가능
  - 시스템 성능과 효율 향상
  - 스레드는 그들이 속한 프로세스의 자원과 메모리를 공유하므로, 응용 프로그램 하나가 같은 주소 공간에서 여러개의 스레드를 실행
- 다중 프로세서 구조 활용
  - 하나의 프로세스가 서로 다른 프로세서에서 프로그램의 다른 부분을 동시에 실행 가능
  - 각 스레드는 다른 프로세서에서 병렬로 실행될 수 있음


## P16. 멀티스레드 시스템
### (1) 다중스레드
단일스레드와 다중스레드
- 운영체제는 단일 프로세스에서 단일스레드 실행과 다중 스레드 실행을 지원

다중 스레드의 특징
- 다중 프로세서와 같은 의미
- 메모리와 파일을 공유 및 다수의 실행 단위로 구분된 자원을 공유
- 커널 개입 없이 서로 통신 가능 및 독립적 실행

### (2) 스레드 모델
**스레드 사용법**

단일 사용자 다중처리 시스템 환경
- 시스템 호출이 아닌  사용자 라이브러리 수준에서도 스레드 개념을 제공
  - 빠른 속도
- 프로그램에 비동기적 요소를 구현 가능
- 실행 중인 스레드를 대기 상태로 변경
  - 다른 스레드로 제어를 이동시키는 상태 변화는 하나의 서버가 많은 요청을 받아들여 처리하는 효과적인 방법

공유 메모리 형태의 다중 프로세서 시스템 환경
- 프로그램을 공유 메모리에 저장
- 스레드를 각 프로세서에 할당
- 병렬 처리하여 프로세서의 성능을 매우 향상시킬 수 있음

### (3) 스레드의 상태 변화
스레드의 특징
- 준비, 실행, 대기, 종료 상태로 구분
  - 프로세서를 함게 사용하며 항상 스레드 하나만 실행됨
- 한 프로세스에 있는 스레드는 순차적으로 실행
  - 자신의 정보를 위한 프로그램 카운터와 스택을 가짐
- 스레드 생성 시, 운영체제는 부모 프로세스와 공유할 자원을 초기화하지 않음
- 프로세스 내 스레드는 해당 프로세스에서 다른 스레드 생성
  - 새로 형성된 스레드를 위한 스택과 레지스터를 제공함으로 프로세스의 생성 및 종료 과정보다 오버헤드가 적음
- 하나의 스레드가 대기 상태로 변할 때 전체 프로세스를 대기 상태로 변화시키지 않음
  - 하나의 스레드가 대기 상태일 경우 다른 스레드 실행 가능
- 서로 독립적이지 않음
  - 한 작업에 있는 모든 스레드는 작업의 모든 주소 접근 가능
- 보호 문제
  - 프로세서는 다수의 사용자에게서 발생, 경쟁적인 자원 요구와 서로 다른 관계 유지
  - 스레드는 한 명의 사용자가 여러 스레드를 가진 작업 하나를 소유

### (4) 스레드의 구현 - 사용자 수준 스레드
#### ㄱ. 사용자 수준 스레드
- 커널 스레드를 지원하지 않는 운영체제에서 사용
- 사용자 수준 스레드 여러개가 커널 스레드 하나로 매핑되는 방식
- 다중스레드 프로세스에 대해 프로세서(실행 문맥) 하나를 할당하므로 다대일 스레드 매핑이라함.

개념
- 사용자 수준에서 스레드 관리가 효율적으로 이루어지므로 스레드와 관련된 모든 과정을 응용프로그램이 수행

#### ㄴ. 스레드 라이브러리
- 스레드 생성, 종료, 문맥 교환을 위한 코드, 동기화, 메모리 할당, 스레드 간 메시지 전달, 스레드 실행 스케줄링 등의 정보를 포함

#### ㄷ. 사용자 수준 스레드의 장점
- 커널 도움 없이 사용자 주소 공간에 구현된 스레드 패키지로 스레드 연산 실행
- 커널은 연산 과정은 모르고 프로세스를 계속 하나의 단위로 스케줄하고 하나의 실행 상태를 할당
- 커널과 상관없이 다양한 목적의 응응 프로그램이나 언어 인터페이스의 요구에 적용할 수 있는 융통성을 가짐
- 여러 수준에서 스레드 구현 가능

#### ㄹ. 사용자 수준 스레드 이용시 시스템의 장점
- 높은 이식성
- 오버헤드 감소
- 스케줄링 유연성

#### ㅁ. 사용자 수준 스레드 이용 시 시스템의 단점
- 시스템의 동시성 지원 불가
  - 한 번에 하나의 스레드만 커널에 접근 가능하므로 여러 스레드가 시스템 호출을 동시에 사용할 수 없음
- 시스템 규모의 확장 제약
  - 커널이 프로세서 내부의 다중스레드를 프로세스 하나로 관리
  - 다중 처리 환경에서 여러 프로세스를 이용한 분산 처리를 할 수 없음
- 스레드 간 보호가 어려움
  - 스레드 간의 보호에 커널의 보호 기법을 사용할 수 없음
  - 스레드 라이버리에서 스레드 간 보호를 제공해야 프로세스 수준에서 보호됨

#### (5) 스레드의 구현 - 커널 수준 스레드
- 커널 개념의 스레드.

#### ㄱ. 개념
- 사용자 영역에는 스레드 관리를 위한 코드가 없음
  - 모든 응용 프로그램은 다중스레드로 지원
  - 응용 프로그램의 스레드는 하나의 프로세스에서 지원
  - 스레드 관련 모든 작업은 커널이 지원
  - 프로세스와 스레드에 대한 실행 문맥 정보 유지

#### ㄴ. 커널 지원 부족 문제 해결
- 커널 지원 부족 문제 해결
  - 커널에 의한 직접적인 스케줄링과 실행으로 사용자 수준 스레드의 문제를 해결하여 시스템 성능 향상
#### ㄷ. 병렬 실행
#### ㄹ. 커널 모드 전환 오버헤드
- 커널 모드로 전환 시 오버헤드가 발생할 수 있음
- 사용자 수준 스레드보다 스케줄링과 동기화를 위한 자원이 더 필요함.


